(window.webpackJsonp=window.webpackJsonp||[]).push([[41,43],{1012:function(e,t,i){var r,a;r=[t,i(154),i(1061)],void 0===(a=function(e,t,r){"use strict";var a=i(0);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=a(t);var l=function(e){return(0,t.default)(e).call(e,(function(e){var t=e.eid;return interaction_view.getCurrentPageModel().iOverlaylist.models.some((function(e){return t===(0,r.getEidByOverlay)({overlayId:e.id,pageId:e.page.id,pageType:e.page.attributes.iType})}))}))};e.default=l}.apply(t,r))||(e.exports=a)},1279:function(e,t,i){var r,a;r=[t,i(337),i(154),i(100),i(8),i(10),i(1012)],void 0===(a=function(e,t,r,a,l,o,n){"use strict";var d=i(0);Object.defineProperty(e,"__esModule",{value:!0}),e.ClonedElements=void 0,t=d(t),r=d(r),n=d(n);var s=[];e.ClonedElements=s;var c={type:"actionexecute",config:{type:"DiyImageActionExec",exec:function(e){var i,a,l=null==e||null===(i=e.model)||void 0===i||null===(a=i.get("iDetail"))||void 0===a?void 0:a.results[0].property,o=l.allowScreenshot,d=(0,n.default)(l.expressions);d.forEach((function(e,i){var a,l=function(e){var t=interaction_view.expression.getElByEid(e).toJSON();return t.id=_g.uuid(),interaction_view.getCurrentPageModel().iOverlaylist.add(new interaction_view.model[t.iType](t)),interaction_view.getCurrentPageModel().iOverlaylist.last()}(e.eid);o&&s.push(l),interaction_view.setXY(l,{x:150,y:300});var n=interaction_view.getCurrentPageModel().iOverlaylist.models,d=(0,t.default)(a=(0,r.default)(n).call(n,(function(e){return"DiyImage"===e.attributes.iType}))).call(a,(function(e,t){var i=t.zIndex;return e>(null!=i?i:-1)?e:i}),n[0].zIndex)+i+1;l.zIndex=d,l.iview.el.style.zIndex=d.toString(),l.iview.el.classList.remove("hide")}))}}};epub360.PlayerPlugins.push(c)}.apply(t,r))||(e.exports=a)},2659:function(e,t,i){var r,a;r=[i(797),i(339),i(27),i(51),i(342),i(798),i(336),i(14),i(4),i(63),i(78),i(100),i(98),i(54),i(213),i(125),i(1279)],void 0===(a=function(e,t,r,a,l,o,n,d,s,c,u,h,g,m,b,v,f){"use strict";var p=i(0);e=p(e),t=p(t),r=p(r),a=p(a),l=p(l),o=p(o),n=p(n),d=p(d),s=p(s),c=p(c),u=p(u),epub360.PlayerPlugins.push({type:"actionexecute",config:{type:512,exec:function(i,h,g){h.immediate((function(){var h=i.model.get("iDetail").results[0].overlay;if(h){var g=interaction_view.getAnimationPage(h.page_id,i.model.page);if(g){var m=g.iOverlaylist.get(h.id);if(m){var b=$("div[id='"+h.id+"'][data-type='ClipBoard']").first(),v=document.createElement("canvas");b.append(v),v.id="clipboard",$("#clipboard").hide();var p=m.toJSON().iDetail.chooseElement,w=i.model.attributes.iDetail.results[0].image_url,y=0,x={overlaylist:[],masterpage:[],background:[]},N=[],_={},S=m.toJSON().iDetail.need_file,k=m.toJSON().iDetail.clipboard_area,W=m.toJSON().iDetail.clipboard_ratio||2,I=1==W?window.devicePixelRatio:W,T=m.toJSON().iCommon.landscape;if(m.toJSON().iDetail.iStyle)for(var C=m.toJSON().iDetail.iStyle.replace(/\-/g,"_").split(";"),O=0;O<C.length;O++){var M=C[O].split(":");_[(0,t.default)($).call($,M[0])]=(0,t.default)($).call($,M[1])}if(k?($(v).css({"margin-top":Number(T.iStarty)*I,"margin-left":Number(T.iStartx)*I}),v.width=Number(T.iWidth)*I,v.height=Number(T.iHeight)*I):(v.width=Number(interaction_view.size.x)*I,interaction_view.ipagelist.getPage(interaction_view.currentPage).get("height")?v.height=Number(interaction_view.ipagelist.getPage(interaction_view.currentPage).get("height"))*I:v.height=Number(interaction_view.size.y)*I),p&&p.length)for(var D=0;D<p.length;D++){var P=g.iOverlaylist.get(p[D].id);P&&!P.iview.$el.hasClass("hide")?x.overlaylist.push(P):interaction_view.imasterlist.at(0).iOverlaylist.get(p[D].id)?(P=interaction_view.imasterlist.at(0).iOverlaylist.get(p[D].id))&&!P.iview.$el.hasClass("hide")&&x.masterpage.push(P):interaction_view.ibackgroundlist.at(0).iOverlaylist.get(p[D].id)&&(P=interaction_view.ibackgroundlist.at(0).iOverlaylist.get(p[D].id))&&!P.iview.$el.hasClass("hide")&&x.background.push(P)}m.attributes.iDetail.containCloned&&f.ClonedElements.forEach((function(e){if(!e.iview.$el.hasClass("hide"))switch(e.page.attributes.type){case"page":interaction_view.getCurrentPageModel().iOverlaylist.models.some((function(t){return t.id===e.id}))&&x.overlaylist.push(e);break;case"master":x.masterpage.push(e);break;case"background":x.background.push(e)}})),x.background&&x.background.length&&H(x.background),x.overlaylist&&x.overlaylist.length&&H(x.overlaylist),x.masterpage&&x.masterpage.length&&H(x.masterpage);var J=document.getElementById("clipboard"),A=J.getContext("2d");if(k){if(_.border_top_style&&(_.border_top_width||_.border_top_left_radius)){var z=_.border_top_left_radius?Number(_.border_top_left_radius.replace("px",""))*I:0,E=Number(T.iWidth)*I,R=Number(T.iHeight)*I;z>Math.min(Number(T.iWidth)*I/2,Number(T.iHeight)*I/2)&&(z=Math.min(Number(T.iWidth)*I/2,Number(T.iHeight)*I/2)),A.beginPath(),A.moveTo(z,0),z=z<0?0:z,A.arcTo(E,0,E,R,z),A.arcTo(E,R,0,R,z),A.arcTo(0,R,0,0,z),A.arcTo(0,0,E,0,z),_.background_color&&(A.fillStyle=_.background_color,(0,r.default)(A).call(A)),A.strokeStyle=_.border_top_color||"black",A.lineWidth=Number(_.border_top_width.replace("px",""))*I*2||1,A.clip(),A.stroke()}A.translate(-Number(T.iStartx)*I,-Number(T.iStarty)*I)}N.length&&B(N[0])}}}function H(e){(0,l.default)(e).call(e,(function(e,t){return(0,a.default)(e.iview.el.style.zIndex)-(0,a.default)(t.iview.el.style.zIndex)}));for(var t=0;t<e.length;t++)N.push(e[t])}function B(e){var t,i,r,a=e.toJSON().iCommon.landscape;e.isMasterOverlay||e.isBackgroundOverlay?(a.iStartx=interaction_view.transform.getState(e).position.x-interaction_view.transform.getState(e).size.width/2-Reveal.marginLeft,a.iStarty=interaction_view.transform.getState(e).position.y-interaction_view.transform.getState(e).size.height/2-Reveal.marginTop):(a.iStartx=interaction_view.transform.getState(e).position.x-interaction_view.transform.getState(e).size.width/2,a.iStarty=interaction_view.transform.getState(e).position.y-interaction_view.transform.getState(e).size.height/2);var l=e.toJSON().iDetail.init_rotation,d=e.iview.zIndex,s=e.toJSON().iDetail.init_opacity,c=e.toJSON().iDetail;e.attributes.iDetail.iEditable&&e._scale&&(a._x=(0,o.default)(e._x),a._y=(0,o.default)(e._y),a._scale=(0,o.default)(e._scale));var u=e.toJSON().iType,h=[e,J,A,a,l,d,s,c];(0,n.default)(t=["Avatar"]).call(t,u)?U.apply(void 0,h):(0,n.default)(i=["ImageBlock","Image","CycleImage","Gallery","Slide","qrcode"]).call(i,u)?c.effect&&2==c.effect?L.apply(void 0,h):q.apply(void 0,h):(0,n.default)(r=["Paragraph","Webfont"]).call(r,u)?c.iStaticImage?q.apply(void 0,h):j.apply(void 0,h):"DiyImage"===u&&F.apply(void 0,h)}function F(t,i,r,l,o,u,h,g){var m,b,v=t.iview.el.querySelector(".diy-image"),f=new Image;f.crossOrigin="anonymous";var p=null===(m=g.images)||void 0===m||null===(b=m[0])||void 0===b?void 0:b.src;if(void 0!==p){f.src=p;var w=v.firstElementChild.children[1],x=(w.clientWidth-24)*I,N=(w.clientHeight-24)*I,_=document.createElement("canvas");_.width=interaction_view.size.x*I,_.height=interaction_view.size.y*I;var S=_.getContext("2d");f.onload=function(){var t,i=v.style.transform,o=(0,d.default)(t=(0,s.default)(i).call(i,(0,c.default)(i).call(i,"(")+1,(0,c.default)(i).call(i,")")).split(",")).call(t,(function(e){return(0,a.default)(e)*I})),u=(0,e.default)(o,2),h=u[0],g=u[1],m=v.firstElementChild.style.transform,b=(0,a.default)((0,s.default)(m).call(m,(0,c.default)(m).call(m,"(")+1,(0,c.default)(m).call(m,")")))*Math.PI/180,p=l.iStartx,k=l.iStarty,W=document.createElement("canvas");W.width=x,W.height=N;var T=W.getContext("2d"),C=w.style.transform.split(" ");C.some((function(e){return(0,n.default)(e).call(e,"rotateY")}))&&(null==T||T.translate(x,0),null==T||T.scale(-1,1)),C.some((function(e){return(0,n.default)(e).call(e,"rotateX")}))&&(null==T||T.translate(0,N),null==T||T.scale(1,-1)),null==T||T.drawImage(f,0,0,x,N);var O=p*I+h+31*I+x/2,M=k*I+g+31*I+N/2;null==S||S.translate(O,M),null==S||S.rotate(b),null==S||S.drawImage(W,-x/2,-N/2,x,N),r.drawImage(_,0,0),y++,V()}}else y++}function U(e,t,i,r,a,l,o,n){var d,s,c=e.toJSON().iDetail.iNickname,h=(0,u.default)(d=$(e.iview.el)).call(d,".thumb"),g=(0,u.default)(s=$(e.iview.el)).call(s,".iTextLabel"),m=Number(g.width())*I,b=Number(g.parent()[0]._gsTransform.x)+Number(g.css("left").replace("px","")),v=Number(g.parent()[0]._gsTransform.y)+Number(g.css("top").replace("px","")),f=Number(g.css("line-height").replace("px","")),p=Number(g.css("font-size").replace("px",""))*I+"px",w=g.css("font-weight"),x=g.css("font-family").split(",")[2],N={borderColor:h.css("border-color"),borderWidth:Number(h.css("border-width").replace("px",""))*I,borderStyle:h.css("border-style"),borderRadius:Number(h.css("border-radius").replace("px",""))*I,background:h.css("background"),"background-size":h.css("background-size")},_={left:Number(r.iStartx)*I,top:Number(r.iStarty)*I,width:Number(r.iWidth)*I,height:Number(r.iHeight)*I},S=new Image,k=h.css("background-image").replace(/url\((.*)\)/,"$1").replace(/"/g,"");interaction_view.setCrossOrigin(S,k),S.src=k;var W,T=b*I,C=v*I;i.save(),i.translate(_.left+_.width/2,_.top+_.height/2),i.rotate(a*Math.PI/180),"center"===g.css("text-align")?W=T+m/2-_.width/2:"left"===g.css("text-align")||"justify"===g.css("text-align")?W=-(_.width/2-T):"right"===g.css("text-align")&&(W=T+m-_.width/2);var O=Number(C-_.height/2),M=g.text();if(i.globalAlpha=o,c&&(i.font=w+" "+p+" "+x,i.fillStyle=g.css("color"),"center"===g.css("text-align")?i.textAlign="center":"left"===g.css("text-align")||"justify"===g.css("text-align")?i.textAlign="left":"right"===g.css("text-align")&&(i.textAlign="right"),i.textBaseline="middle",i.fillText(M,W,O+f*I/2)),_.width==_.height&&N.borderRadius>_.width/2&&N.borderRadius>_.height/2)i.beginPath(),i.arc(0,0,_.width/2,0,2*Math.PI,!1),i.lineWidth=2*N.borderWidth,i.clip();else{var D,P=-_.width/2,J=-_.height/2,A=_.width,z=_.height;N.borderRadius>_.height/2?D=_.height/2:N.borderRadius<=_.height/2&&(D=N.borderRadius),i.beginPath(),i.moveTo(P+D,J),D=D<0?0:D,i.arcTo(P+A,J,P+A,J+z,D),i.arcTo(P+A,J+z,P,J+z,D),i.arcTo(P,J+z,P,J,D),i.arcTo(P,J,P+A,J,D),i.lineWidth=2*N.borderWidth,i.clip()}S.complete?(i.drawImage(S,-_.width/2+N.borderWidth,-_.height/2+N.borderWidth,_.width-2*N.borderWidth,_.height-2*N.borderWidth),i.strokeStyle=N.borderColor,i.stroke(),i.restore(),y++,V()):S.onload=function(){i.drawImage(S,-_.width/2+N.borderWidth,-_.height/2+N.borderWidth,_.width-2*N.borderWidth,_.height-2*N.borderWidth),i.strokeStyle=N.borderColor,i.stroke(),i.restore(),y++,V()}}function L(e,t,i,r,a,l,o,n){t=(0,u.default)(d=(0,u.default)(s=e.iview.$el).call(s,".el_wrap")).call(d,"canvas")[0];var d,s,c=Number(r.iStartx)*I,h=Number(r.iStarty)*I,g=Number(r.iWidth)*I,m=Number(r.iHeight)*I;i.save(),i.globalAlpha=o,i.translate(c+g/2,h+m/2),i.rotate(a*Math.PI/180),i.drawImage(t,-g/2,-m/2),i.restore(),y++,V()}function q(e,t,i,r,a,l,o,n){var d,s,h,g,m,b,v,f,p,w=!1;"Slide"==e.toJSON().iType||"CycleImage"==e.toJSON().iType?m=(0,u.default)(f=e.iview.$el).call(f,".slidecontent"):m=(0,u.default)(p=e.iview.$el).call(p,".el_wrap");var x,N={borderWidth:Number(m.css("border-width").replace("px",""))*I,borderColor:m.css("border-color"),borderRadius:Number(m.css("border-radius").replace("px",""))*I,borderStyle:m.css("border-style")},_=new Image;if("none"!=m.css("background-image")&&null!=m.css("background-image"))x=m.css("background-image").match(/url\(\"?(.[^"]*)\"?\)/)[1];else if("CycleImage"==e.toJSON().iType){var S=e.iview.currentIndex;x=e.iImgs[S].src}else{if(0==(0,u.default)(d=$(e.iview.el)).call(d,"img").length)return y++,void V();if("Slide"==e.toJSON().iType){var k,W=e.iview.currentSlideIndex;x=(0,u.default)(k=$(e.iview.el)).call(k,"img").eq(W).attr("src")}else{var T;x=(0,u.default)(T=$(e.iview.el)).call(T,"img").attr("src")}}interaction_view.setCrossOrigin(_,x),_.src=x,n.iImgMask&&n.iImgMaskUrl&&(b=n.iImgMaskUrl,v=n.iImgMask_data,(g=new Image).src=b),-1!=(0,c.default)(s=_.src).call(s,"svg")&&(w=2==e.toJSON().iDetail.iDisplay?2:1),h=new Image,interaction_view.setCrossOrigin(h,_.src),h.src=_.src;var C,O=Number(r.iStartx)*I,M=Number(r.iStarty)*I,D=Number(r.iWidth)*I,P=Number(r.iHeight)*I,J=(D-2*N.borderWidth)/D,A=(P-2*N.borderWidth)/P;if(C=Math.min(D,P)/2<N.borderRadius?Math.min(D,P)/2:N.borderRadius,i.save(),i.globalAlpha=o,i.translate(O+D/2,M+P/2),i.rotate(a*Math.PI/180),i.beginPath(),i.moveTo(-(D/2-C),-P/2),C=C<0?0:C,i.arcTo(D/2,-P/2,D/2,P/2,C),i.arcTo(D/2,P/2,-D/2,P/2,C),i.arcTo(-D/2,P/2,-D/2,-P/2,C),i.arcTo(-D/2,-P/2,D/2,-P/2,C),i.strokeStyle="rgba(0,0,0,0)",i.clip(),e.attributes.iDetail.iEditable&&(e._scale||e._x||e._y||e._rotate))if(h.complete){var z=h.height/h.width,E=D*Number(e._scale),R=E*z,H=-(P/2-R/2/Number(e._scale));i.translate(0,H),i.rotate(Number(e._rotate)*Math.PI/180),i.translate(Number(e._x)*Number(e._scale)*I,Number(e._y)*Number(e._scale)*I),i.drawImage(h,-E*J/2,-R*J/2,E*J,R*J),0!=N.borderWidth&&(i.lineWidth=2*N.borderWidth,i.strokeStyle=N.borderColor),i.stroke(),i.restore(),y++,V()}else h.onload=function(){var t=h.height/h.width,r=D*Number(e._scale),a=r*t,l=-(P/2-a/2/Number(e._scale));i.translate(0,l),i.rotate(Number(e._rotate)*Math.PI/180),i.translate(Number(e._x)*Number(e._scale)*I,Number(e._y)*Number(e._scale)*I),i.drawImage(h,-r*J/2,-a*J/2,r*J,a*J),0!=N.borderWidth&&(i.lineWidth=2*N.borderWidth,i.strokeStyle=N.borderColor),i.stroke(),i.restore(),y++,V()};else if(1!=e.toJSON().iDetail.iDisplay&&1!=w)if(2!=e.toJSON().iDetail.iDisplay&&2!=w)if(h.complete)if(n.iMask){var B=n.iMask_data;i.drawImage(h,-D*J/2+B.x*I,-P*A/2+B.y*I,B.width*I*J,B.height*I*A),i.globalCompositeOperation="destination-in",i.fillStyle="red",i.fillRect(-D/2,-P/2,D,P),i.restore(),y++,V()}else if(n.iImgMask&&n.iImgMaskUrl){b=n.iImgMaskUrl,v=n.iImgMask_data,g=new Image,interaction_view.setCrossOrigin(g,b);var F=(Number(v.width)/Number(v.height)).toFixed(1);g.onload=function(){var e;if(-1!=(0,c.default)(e=g.src).call(e,"svg")){var t,r,a=g.width/g.height,l=a.toFixed(1);F>=l?r=(t=v.height*I)*a:t=(r=v.width*I)/a}else r=v.width*I,t=v.height*I;var o=document.createElement("canvas");$("body").append(o),o.id="canvasp",o.width=D*J,o.height=P*A,$("#canvasp").hide();var n=document.querySelector("#canvasp"),d=n.getContext("2d");d.drawImage(h,0,0,D*J,P*A),d.globalCompositeOperation="destination-in",d.drawImage(g,v.x*I+(v.width*I-r)/2,v.y*I+(v.height*I-t)/2,r,t),0!=N.borderWidth&&(d.lineWidth=2*N.borderWidth,d.strokeStyle=N.borderColor);var s=n.toDataURL("image/png"),u=new Image;interaction_view.setCrossOrigin(u,s),u.onload=function(){i.drawImage(u,-D*J/2,-P*A/2,D*J,P*A),i.restore(),$("#canvasp").remove(),y++,V()},u.src=s},g.src=b}else i.drawImage(h,-D*J/2,-P*A/2,D*J,P*A),0!=N.borderWidth&&(i.lineWidth=2*N.borderWidth,i.strokeStyle=N.borderColor),i.stroke(),i.restore(),y++,V();else h.onload=function(){if(n.iMask){var e=n.iMask_data;i.drawImage(h,-D*J/2+e.x*I,-P*A/2+e.y*I,e.width*I*J,e.height*I*A),i.globalCompositeOperation="destination-in",i.fillStyle="red",i.fillRect(-D/2,-P/2,D,P),i.restore(),y++,V()}else if(n.iImgMask&&n.iImgMaskUrl){b=n.iImgMaskUrl,v=n.iImgMask_data,g=new Image,interaction_view.setCrossOrigin(g,b);var t=(Number(v.width)/Number(v.height)).toFixed(1);g.onload=function(){var e;if(-1!=(0,c.default)(e=g.src).call(e,"svg")){var r,a,l=g.width/g.height,o=l.toFixed(1);t>=o?a=(r=v.height*I)*l:r=(a=v.width*I)/l}else a=v.width*I,r=v.height*I;var n=document.createElement("canvas");$("body").append(n),n.id="canvasp",n.width=D*J,n.height=P*A,$("#canvasp").hide();var d=document.querySelector("#canvasp"),s=d.getContext("2d");s.drawImage(h,0,0,D*J,P*A),s.globalCompositeOperation="destination-in",s.drawImage(g,v.x*I+(v.width*I-a)/2,v.y*I+(v.height*I-r)/2,a,r),0!=N.borderWidth&&(s.lineWidth=2*N.borderWidth,s.strokeStyle=N.borderColor);var u=d.toDataURL("image/png"),m=new Image;interaction_view.setCrossOrigin(m,u),m.onload=function(){i.drawImage(m,-D*J/2,-P*A/2,D*J,P*A),i.restore(),$("#canvasp").remove(),y++,V()},m.src=u},g.src=b}else i.drawImage(h,-D*J/2,-P*A/2,D*J,P*A),0!=N.borderWidth&&(i.lineWidth=2*N.borderWidth,i.strokeStyle=N.borderColor),i.stroke(),i.restore(),y++,V()};else{U=(Number(r.iHeight)/Number(r.iWidth)).toFixed(1);if(h.complete){q=(L=h.height/h.width).toFixed(1);if(U<=q)X=(j=D-2*N.borderWidth)*L;else j=(X=P-2*N.borderWidth)/L;i.drawImage(h,-j/2,-X/2,j,X),0!=N.borderWidth&&(i.lineWidth=2*N.borderWidth,i.strokeStyle=N.borderColor),i.stroke(),i.restore(),y++,V()}else h.onload=function(){var e=h.height/h.width,t=e.toFixed(1);if(U<=t)var r=(a=D-2*N.borderWidth)*e;else var a=(r=P-2*N.borderWidth)/e;i.drawImage(h,-a/2,-r/2,a,r),0!=N.borderWidth&&(i.lineWidth=2*N.borderWidth,i.strokeStyle=N.borderColor),i.stroke(),i.restore(),y++,V()}}else{var U=(Number(r.iWidth)/Number(r.iHeight)).toFixed(1);if(h.complete){var L,q=(L=h.width/h.height).toFixed(1);if(U>=q)var j=(X=P-2*N.borderWidth)*L;else var X=(j=D-2*N.borderWidth)/L;i.drawImage(h,-j/2,-X/2,j,X),0!=N.borderWidth&&(i.lineWidth=2*N.borderWidth,i.strokeStyle=N.borderColor),i.stroke(),i.restore(),y++,V()}else h.onload=function(){var e=h.width/h.height,t=e.toFixed(1);if(U>=t)var r=(a=P-N.borderWidth*I)*e;else var a=(r=D-2*N.borderWidth)/e;i.drawImage(h,-r/2,-a/2,r,a),0!=N.borderWidth&&(i.lineWidth=2*N.borderWidth,i.strokeStyle=N.borderColor),i.stroke(),i.restore(),y++,V()}}}function j(e,t,i,r,a,l,o,n){var d,s,c,h,g=e.toJSON().iDetail.iText,m=(0,u.default)(d=e.iview.$el).call(d,".iText").children().length;(0,u.default)(s=e.iview.$el).call(s,".iText .iContent").length>0&&(m=(0,u.default)(h=e.iview.$el).call(h,".iText .iContent").children().length);var b=(0,u.default)(c=e.iview.$el).call(c,".el_wrap"),v=b.children(".iText").length?b.children(".iText"):b,f={"font-size":v.css("font-size"),"background-color":b.css("background-color"),"font-family":v.css("font-family"),color:v.css("color"),"border-width":b.css("border-width"),"border-color":b.css("border-color"),"text-align":b.css("text-align"),"line-height":b.css("line-height"),"padding-top":b.css("padding-top"),"padding-left":b.css("padding-left"),"font-weight":v.css("font-weight"),"border-radius":b.css("border-radius"),"text-indent":b.css("text-indent")},p=e.toJSON().iDetail.iStyle.split(";");1==m||0==m?X(e.toJSON().iDetail.iText.replace("<div>","").replace("</div>",""),t,Number(r.iStartx)*I,Number(r.iStarty)*I,Number(r.iWidth)*I,p,r,a,f):function(e,t,i,r,a,l,o,n,d){var s=e.getContext("2d"),c=Number(d["font-size"].replace("px",""))*I+"px",u=d["font-family"].split(",")[0]?d["font-family"].split(",")[2]:d["font-family"],h=d["font-weight"];s.font=h+" "+c+" "+u,s.fillStyle=d.color;var g=function(e){new Array;return e=e.replace(/<div>/g,""),e.split("</div>")}(t),m=Number(d["line-height"].replace("px",""))*I;Number(o.iHeight);if(0!=n)for(var b=0;b<g.length;b++){var v=X(g[b],e,i,r,a,l,o,n,d);r=v[0];var f=v[1];r+=m*f}else for(var p=0;p<g.length;p++){v=X(g[p],e,i,r,a,l,o,n,d);r=v[0];f=v[1];r+=m*f}}(t,g,Number(r.iStartx)*I,Number(r.iStarty)*I,Number(r.iWidth)*I,p,r,a,f);y++,V()}function V(){if(0!==N.length&&y==N.length){var e,t=$("canvas#clipboard")[0];if(0==S){try{var r="image/webp";void 0!==window.e_Debug_base64type&&(r=window.e_Debug_base64type),e=t.toDataURL(r)}catch(e){interaction_view.errorAlert(e)}if(w&&interaction_view.expression.setValue(w,e),$("#clipboard").remove(),i.executeactions.length)for(var a=0;a<i.executeactions.length;a++){var l=i.executeactions[a];"onClipBoardSuccess"==l.attributes.iDetail.customType&&l.iview.executeAction(l.iview)}}else{try{e=t.toDataURL("image/png")}catch(e){interaction_view.errorAlert(e)}var o=_g.fileapi.base64urltoBase64(e),n=_g.fileapi.b64toBlob({b64Data:o}),d=context_url+"uploadimage";_g.fileapi.sendBinary({blob:n,url:d,filekey:"image",filename:"canvas图片"+_g.uuid(1),callback:function(e){var t=e.data.results[0];if(w&&interaction_view.expression.setValue(w,t),$("#clipboard").remove(),i.executeactions.length)for(var r=0;r<i.executeactions.length;r++){var a=i.executeactions[r];"onClipBoardSuccess"==a.attributes.iDetail.customType&&a.iview.executeAction(a.iview)}}})}}else y<N.length&&B(N[y])}function X(e,t,i,r,l,o,n,d,s){var c=/([\[\]\,.?"'\(\)+_*\/\\&\$#^@!%~`<>:;\{\}？，。·！……（）+｛｝【】、|《》])/gi,u=t.getContext("2d"),h=Number(s["font-size"].replace("px",""))*I+"px",g=s["font-family"].split(",")[2]?s["font-family"].split(",")[2]:s["font-family"],m=s["font-weight"],b=0,v=s["text-indent"]?(0,a.default)(s["text-indent"]):0;u.font=m+" "+h+" "+g,u.fillStyle=s.color,u.textBaseline="top",u.textAlign="left",u.lineHeight=s["line-height"],s["text-align"]&&("center"==s["text-align"]?u.textAlign="center":"right"==s["text-align"]?u.textAlign="right":u.textAlign=s["text-align"]);var f=0,p=0,w=0,y=i,x=/(\d+\.?\d*)px/,N=Number(s["padding-left"].match(x)[1]),_=Number(s["padding-top"].match(x)[1]),S=Number(s["line-height"].match(x)[1]),k=(h=Number(s["font-size"].match(x)[1]),r+_*I+(S-h)/2*I),W=Number(s["border-radius"].replace("px",""))*I;if(0!=d){if(u.save(),u.translate(Number(n.iStartx)*I+Number(n.iWidth)*I/2,Number(n.iStarty)*I+Number(n.iHeight)*I/2),u.rotate(d*Math.PI/180),"0px"!=s["border-width"]){var T=Number(n.iWidth)*I,C=Number(n.iHeight)*I;f=Number(s["border-width"].replace("px",""))*I;J=(J=Math.min(T,C)/2<W?Math.min(T,C)/2:W)<0?0:J,u.moveTo(-(T/2-J),-C/2),u.arcTo(T/2,-C/2,T/2,C/2,J),u.arcTo(T/2,C/2,-T/2,C/2,J),u.arcTo(-T/2,C/2,-T/2,-C/2,J),u.arcTo(-T/2,-C/2,T/2,-C/2,J),u.beginPath(),A=(A=J-f/2)<0?0:J,u.moveTo(-(T/2-J-f/2+f/2),-(C/2-f/2)),u.arcTo(T/2-f/2,-(C/2-f/2),T/2-f/2,C/2-f/2,A),u.arcTo(T/2-f/2,C/2-f/2,-(T/2-f/2),C/2-f/2,A),u.arcTo(-(T/2-f/2),C/2-f/2,-(T/2-f/2),-(C/2-f/2),A),u.arcTo(-(T/2-f/2),-(C/2-f/2),T/2-f/2,-(C/2-f/2),A),u.lineWidth=f,u.strokeStyle=s["border-color"],u.stroke()}var O=-Number(n.iWidth)*I/2;O="center"==u.textAlign?O+l/2+f:"right"==u.textAlign?O+l-N*I+f:O+N*I+f;var M=-(Number(n.iHeight)*I/2+Number(n.iStarty*I))+Number(k)+f;if(u.measureText(e[0]).width>l)for(var D=1;D<=e.length;D++){b++;var $=O;u.fillText(e.substring(w,D),$,M),M+=S*I,p=0,w=D}else for(var P=0;P<e.length;P++)(p+=u.measureText(e[P]).width)>=l-2*N*I-2*f&&(c.test(e[P])?(b++,u.fillText(e.substring(w,P-1),O,M),M+=S*I,p=0,w=P-1):(b++,u.fillText(e.substring(w,P),O,M),M+=S*I,p=0,w=P)),P==e.length-1&&(b++,u.fillText(e.substring(w,P+1),O,M));return u.restore(),[r,b]}if("0px"!=s["border-width"]){var J,A,z=Number(n.iStartx)*I,E=Number(n.iStarty)*I;T=Number(n.iWidth)*I,C=Number(n.iHeight)*I,f=Number(s["border-width"].replace("px",""))*I;A=(A=(J=Math.min(T,C)/2<W?Math.min(T,C)/2:W)-f/2)<0?0:J,u.beginPath(),u.moveTo(z+J-f/2+f/2,E+f/2),u.arcTo(z+T-f/2,E+f/2,z+T-f/2,E+C-f/2,A),u.arcTo(z+T-f/2,E+C-f/2,z+f/2,E+C-f/2,A),u.arcTo(z+f/2,E+C-f/2,z+f/2,E+f/2,A),u.arcTo(z+f/2,E+f/2,z+T-f/2,E+f/2,A),u.lineWidth=f,u.strokeStyle=s["border-color"],u.stroke(),k+=f,i+=f,l-=2*f}if(y="center"==u.textAlign?i+l/2:"right"==u.textAlign?i+l-N*I:i+N*I,u.measureText(e[0]).width>l)for(var R=1;R<=e.length;R++){var H=1===R?y+v:y;b++,u.fillText(e.substring(w,R),H,k),k+=S*I,p=0,w=R}else{p=0;for(var B=0;B<e.length;B++){var F=0===b?v*I:0;(p+=u.measureText(e[B]).width)+F>l-2*N*I?(b++,u.fillText(e.substring(w,B),y+F,k),k+=S*I,p=u.measureText(e[B]).width,w=B):B===e.length-1&&(u.fillText(e.substring(w,B+1),y+F,k),b++)}}return[r,b]}}),null,{debug:g})},setExecuteActions:function(e,t,i){i||(i={}),e.executeactions=[];for(var r=0;r<t.length;r++){var a=$.extend(!0,{},t[r]),l=new interaction_view.model.Action(a);l.iview.render(),e.executeactions.push(l)}}}})}.apply(t,r))||(e.exports=a)}}]);