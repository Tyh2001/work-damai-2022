(window.webpackJsonp=window.webpackJsonp||[]).push([[102],{2694:function(t,i,e){var s,r;s=[e(8),e(10),e(4),e(63),e(99),e(27)],void 0===(r=function(t,i,s,r,a,n){"use strict";var h=e(0);s=h(s),r=h(r),a=h(a),n=h(n),function(){function t(t,i,e,s,r,a){this.canvas=t,this.img=i,this.opacity=r||1,this.blurRadius=a||20,this.prepareBackground(e,s),this.w=this.canvas.width,this.h=this.canvas.height,this.prepareGlass(),this.drops=[],this.animateDrops(),this.reflection=this.REFLECTION_MINIATURE,this.trail=this.TRAIL_DROPS,this.gravity=this.GRAVITY_NON_LINEAR,this.VARIABLE_GRAVITY_THRESHOLD=3,this.VARIABLE_GRAVITY_ANGLE=Math.PI/2,this.VARIABLE_GRAVITY_ANGLE_VARIANCE=0,this.VARIABLE_FPS=15,this.VARIABLE_FILL_STYLE="#8ED6FF",this.VARIABLE_COLLISIONS=!0,this.REFLECTION_SCALEDOWN_FACTOR=5,this.REFLECTION_DROP_MAPPING_WIDTH=200,this.REFLECTION_DROP_MAPPING_HEIGHT=200,this.collision=this.COLLISION_SIMPLE}var i;function e(t,i,e,s,r){this.x=Math.floor(i),this.y=Math.floor(e),this.r1=Math.random()*r+s,this.rainyday=t;this.r2=.8*this.r1,this.linepoints=t.getLinepoints(4),this.context=t.context,this.reflection=t.reflected}t.prototype.animateDrops=function(){var t,e=window.requestAnimationFrame;this.addDropCallback&&this.addDropCallback();for(var r=(0,s.default)(t=this.drops).call(t),a=[],n=0;n<r.length;++n)r[n].animate()&&a.push(r[n]);this.drops=a,i=e(this.animateDrops.bind(this))},t.prototype.destroy=function(){i&&(window.cancelAnimationFrame(i),i=null)},t.prototype.prepareReflections=function(){this.reflected=document.createElement("canvas"),this.reflected.width=this.canvas.width/this.REFLECTION_SCALEDOWN_FACTOR,this.reflected.height=this.canvas.height/this.REFLECTION_SCALEDOWN_FACTOR,this.reflected.getContext("2d").drawImage(this.img,0,0,this.reflected.width,this.reflected.height)},t.prototype.prepareGlass=function(){this.glass=document.createElement("canvas"),this.glass.width=this.canvas.width,this.glass.height=this.canvas.height,this.context=this.glass.getContext("2d")},t.prototype.preset=function(t,i,e){return{min:t,base:i,quan:e}},t.prototype.rain=function(t,i){if(this.reflection!=this.REFLECTION_NONE&&this.prepareReflections(),i>0){if(this.presets=t,this.PRIVATE_GRAVITY_FORCE_FACTOR_Y=.005*this.VARIABLE_FPS/25,this.PRIVATE_GRAVITY_FORCE_FACTOR_X=(Math.PI/2-this.VARIABLE_GRAVITY_ANGLE)*(.005*this.VARIABLE_FPS)/50,this.VARIABLE_COLLISIONS){for(var s=0,r=0;r<t.length;r++)t[r].base+t[r].min>s&&(s=Math.floor(t[r].base+t[r].min));if(s>0){var a=Math.ceil(this.w/s),n=Math.ceil(this.h/s);this.matrix=new c(a,n,s)}else this.VARIABLE_COLLISIONS=!1}var h=0;this.addDropCallback=function(){var s=(new Date).getTime();if(!(s-h<i)){h=s;var r=this.canvas.getContext("2d");r.clearRect(0,0,this.canvas.width,this.canvas.height),r.drawImage(this.background,0,0,this.canvas.width,this.canvas.height);for(var a,n=Math.random(),o=0;o<t.length;o++)if(n<t[o].quan){a=t[o];break}a&&this.putDrop(new e(this,Math.random()*this.w,Math.random()*this.h,a.min,a.base)),r.save(),r.globalAlpha=this.opacity,r.drawImage(this.glass,0,0,this.canvas.width,this.canvas.height),r.restore()}}.bind(this)}else for(r=0;r<t.length;r++)for(var o=t[r],l=0;l<o.quan;++l)this.putDrop(new e(this,Math.random()*this.w,Math.random()*this.h,o.min,o.base))},t.prototype.putDrop=function(t){t.draw(),this.gravity&&t.r1>this.VARIABLE_GRAVITY_THRESHOLD&&(this.VARIABLE_COLLISIONS&&this.matrix.update(t),this.drops.push(t))},t.prototype.clearDrop=function(t,i){var e=t.clear(i);if(e){var s,n,h=(0,r.default)(s=this.drops).call(s,t);h>=0&&(0,a.default)(n=this.drops).call(n,h,1)}return e},t.prototype.getLinepoints=function(t){var i,e,s,r,a,n={first:{x:0,y:1}},h=1,o=1;n.first.next={x:1,y:1};for(var l=0;l<t;l++)for(i=n.first;null!=i.next;){s=(e=i.next).x-i.x,r=.5*(i.x+e.x),a=.5*(i.y+e.y);var c={x:r,y:a+=s*(2*Math.random()-1)};a<h?h=a:a>o&&(o=a),c.next=e,i.next=c,i=e}if(o!=h){var d=1/(o-h);for(i=n.first;null!=i;)i.y=d*(i.y-h),i=i.next}else for(i=n.first;null!=i;)i.y=1,i=i.next;return n},e.prototype.draw=function(){var t,i,e,s,r;for(this.context.save(),this.context.beginPath(),t=this.linepoints.first,e=0,i=this.r2+.5*Math.random()*(this.r2-this.r1),s=this.x+i*Math.cos(e),r=this.y+i*Math.sin(e),this.context.lineTo(s,r);null!=t.next;)t=t.next,e=2*Math.PI*t.x+0,i=this.r2+.5*Math.random()*(this.r2-this.r1),s=this.x+i*Math.cos(e),r=this.y+i*Math.sin(e),this.context.lineTo(s,r);this.context.clip(),this.rainyday.reflection&&this.rainyday.reflection(this),this.context.restore()},e.prototype.clear=function(t){return this.context.clearRect(this.x-this.r1-1,this.y-this.r1-1,2*this.r1+2,2*this.r1+2),t?(this.terminate=!0,!0):this.y-this.r1>this.rainyday.h||(this.x-this.r1>this.rainyday.w||this.x+this.r1<0)},e.prototype.animate=function(){if(this.terminate)return!1;var t=this.rainyday.gravity(this);if(!t&&this.rainyday.trail&&this.rainyday.trail(this),this.rainyday.VARIABLE_COLLISIONS){var i=this.rainyday.matrix.update(this,t);i&&this.rainyday.collision(this,i)}return!t||this.terminate},e.prototype.merge=function(t){},t.prototype.TRAIL_NONE=function(t){},t.prototype.TRAIL_DROPS=function(t){(!t.trail_y||t.y-t.trail_y>=10*Math.random()*t.r1)&&(t.trail_y=t.y,this.putDrop(new e(this,t.x,t.y-t.r1-5,0,Math.ceil(t.r1/5))))},t.prototype.TRAIL_SMUDGE=function(t){this.canvas.getContext("2d");var i=t.y-t.r1-2,e=t.x-t.r2+2*Math.random();if(!(i<0||e<0))t.r2},t.prototype.GRAVITY_NONE=function(t){return!0},t.prototype.GRAVITY_LINEAR=function(t){return!!this.clearDrop(t)||(t.yspeed?(t.yspeed+=this.PRIVATE_GRAVITY_FORCE_FACTOR_Y*Math.floor(t.r1),t.xspeed+=this.PRIVATE_GRAVITY_FORCE_FACTOR_X*Math.floor(t.r1)):(t.yspeed=this.PRIVATE_GRAVITY_FORCE_FACTOR_Y,t.xspeed=this.PRIVATE_GRAVITY_FORCE_FACTOR_X),t.y+=t.yspeed,t.draw(),!1)},t.prototype.GRAVITY_NON_LINEAR=function(t){return!!this.clearDrop(t)||(t.collided?(t.collided=!1,t.seed=Math.floor(t.r1*Math.random()*this.VARIABLE_FPS),t.skipping=!1,t.slowing=!1):(!t.seed||t.seed<0)&&(t.seed=Math.floor(t.r1*Math.random()*this.VARIABLE_FPS),t.skipping=0==t.skipping,t.slowing=!0),t.seed--,t.yspeed?t.slowing?(t.yspeed/=1.1,t.xspeed/=1.1,t.yspeed<this.PRIVATE_GRAVITY_FORCE_FACTOR_Y&&(t.slowing=!1)):t.skipping?(t.yspeed=this.PRIVATE_GRAVITY_FORCE_FACTOR_Y,t.xspeed=this.PRIVATE_GRAVITY_FORCE_FACTOR_X):(t.yspeed+=1*this.PRIVATE_GRAVITY_FORCE_FACTOR_Y*Math.floor(t.r1),t.xspeed+=1*this.PRIVATE_GRAVITY_FORCE_FACTOR_X*Math.floor(t.r1)):(t.yspeed=this.PRIVATE_GRAVITY_FORCE_FACTOR_Y,t.xspeed=this.PRIVATE_GRAVITY_FORCE_FACTOR_X),0!=this.VARIABLE_GRAVITY_ANGLE_VARIANCE&&(t.xspeed+=(2*Math.random()-1)*this.VARIABLE_GRAVITY_ANGLE_VARIANCE),t.y+=t.yspeed,t.x+=t.xspeed,t.draw(),!1)},t.prototype.REFLECTION_NONE=function(t){var i;this.context.fillStyle=this.VARIABLE_FILL_STYLE,(0,n.default)(i=this.context).call(i)},t.prototype.REFLECTION_MINIATURE=function(t){var i=Math.max((t.x-this.REFLECTION_DROP_MAPPING_WIDTH)/this.REFLECTION_SCALEDOWN_FACTOR,0),e=Math.max((t.y-this.REFLECTION_DROP_MAPPING_HEIGHT)/this.REFLECTION_SCALEDOWN_FACTOR,0),s=Math.min(2*this.REFLECTION_DROP_MAPPING_WIDTH/this.REFLECTION_SCALEDOWN_FACTOR,this.reflected.width-i),r=Math.min(2*this.REFLECTION_DROP_MAPPING_HEIGHT/this.REFLECTION_SCALEDOWN_FACTOR,this.reflected.height-e);this.context.drawImage(this.reflected,i,e,s,r,t.x-t.r1,t.y-t.r1,2*t.r1,2*t.r1)},t.prototype.COLLISION_SIMPLE=function(t,i){for(var e,s,r,a=i;null!=a;){var n=a.drop;if(Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))<t.r1+n.r1){e=n;break}a=a.next}e&&(t.y>e.y?(s=t,r=e):(s=e,r=t),this.clearDrop(r),this.clearDrop(s,!0),r.draw(),s.merge(r),r.r1=.8*Math.sqrt(r.r1*r.r1+s.r2*s.r2),r.r2=.8*r.r1,r.collided=!0)};var h=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],o=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function l(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}function c(t,i,e){this.resolution=e,this.xc=t,this.yc=i,this.matrix=new Array(t);for(var s=0;s<=t+5;s++){this.matrix[s]=Array(i);for(var r=0;r<=i+5;++r)this.matrix[s][r]=new d(null)}}function d(t){this.drop=t,this.next=null}t.prototype.prepareBackground=function(t,i){t&&i?(this.canvas.style.width=t+"px",this.canvas.style.height=i+"px",this.canvas.width=t,this.canvas.height=i):(t=this.canvas.width,i=this.canvas.height),this.background=document.createElement("canvas"),this.background.width=this.canvas.width,this.background.height=this.canvas.height,this.background.getContext("2d").clearRect(0,0,t,i),isNaN(this.blurRadius)||this.blurRadius<1||this.stackBlurCanvasRGB(0,0,t,i,this.blurRadius)},t.prototype.stackBlurCanvasRGB=function(t,i,e,s,r){r|=0;for(var a,n,c,d,p,R,A,u,_,I,f,y,E,g,x,T,O,m,L,v=this.background.getContext("2d"),C=v.getImageData(t,i,e,s),N=C.data,V=r+r+1,w=e-1,F=s-1,M=r+1,b=M*(M+1)/2,G=new l,P=G,D=1;D<V;D++)if(P=P.next=new l,D==M)var S=P;P.next=G;var Y=null,B=null;R=p=0;var k=h[r],H=o[r];for(n=0;n<s;n++){E=g=x=A=u=_=0,I=M*(T=N[p]),f=M*(O=N[p+1]),y=M*(m=N[p+2]),A+=b*T,u+=b*O,_+=b*m,P=G;for(D=0;D<M;D++)P.r=T,P.g=O,P.b=m,P=P.next;for(D=1;D<M;D++)c=p+((w<D?w:D)<<2),A+=(P.r=T=N[c])*(L=M-D),u+=(P.g=O=N[c+1])*L,_+=(P.b=m=N[c+2])*L,E+=T,g+=O,x+=m,P=P.next;for(Y=G,B=S,a=0;a<e;a++)N[p]=A*k>>H,N[p+1]=u*k>>H,N[p+2]=_*k>>H,A-=I,u-=f,_-=y,I-=Y.r,f-=Y.g,y-=Y.b,c=R+((c=a+r+1)<w?c:w)<<2,A+=E+=Y.r=N[c],u+=g+=Y.g=N[c+1],_+=x+=Y.b=N[c+2],Y=Y.next,I+=T=B.r,f+=O=B.g,y+=m=B.b,E-=T,g-=O,x-=m,B=B.next,p+=4;R+=e}for(a=0;a<e;a++){g=x=E=u=_=A=0,I=M*(T=N[p=a<<2]),f=M*(O=N[p+1]),y=M*(m=N[p+2]),A+=b*T,u+=b*O,_+=b*m,P=G;for(D=0;D<M;D++)P.r=T,P.g=O,P.b=m,P=P.next;d=e;for(D=1;D<=r;D++)p=d+a<<2,A+=(P.r=T=N[p])*(L=M-D),u+=(P.g=O=N[p+1])*L,_+=(P.b=m=N[p+2])*L,E+=T,g+=O,x+=m,P=P.next,D<F&&(d+=e);for(p=a,Y=G,B=S,n=0;n<s;n++)N[c=p<<2]=A*k>>H,N[c+1]=u*k>>H,N[c+2]=_*k>>H,A-=I,u-=f,_-=y,I-=Y.r,f-=Y.g,y-=Y.b,c=a+((c=n+M)<F?c:F)*e<<2,A+=E+=Y.r=N[c],u+=g+=Y.g=N[c+1],_+=x+=Y.b=N[c+2],Y=Y.next,I+=T=B.r,f+=O=B.g,y+=m=B.b,E-=T,g-=O,x-=m,B=B.next,p+=e}v.putImageData(C,t,i)},c.prototype.update=function(t,i){if(t.gid){if(this.matrix[t.gmx][t.gmy].remove(t),i)return null;t.gmx=Math.floor(t.x/this.resolution),t.gmy=Math.floor(t.y/this.resolution),this.matrix[t.gmx][t.gmy].add(t);var e=this.collisions(t);if(e&&null!=e.next)return e.next}else t.gid=Math.random().toString(36).substr(2,9),t.gmx=Math.floor(t.x/this.resolution),t.gmy=Math.floor(t.y/this.resolution),this.matrix[t.gmx][t.gmy].add(t);return null},c.prototype.collisions=function(t){var i=new d(null),e=i;return i=this.addAll(i,t.gmx-1,t.gmy+1),i=this.addAll(i,t.gmx,t.gmy+1),i=this.addAll(i,t.gmx+1,t.gmy+1),e},c.prototype.addAll=function(t,i,e){if(i>0&&e>0&&i<this.xc&&e<this.yc)for(var s=this.matrix[i][e];null!=s.next;)s=s.next,t.next=new d(s.drop),t=t.next;return t},d.prototype.add=function(t){for(var i=this;null!=i.next;)i=i.next;i.next=new d(t)},d.prototype.remove=function(t){for(var i=this,e=null;null!=i.next;)e=i,(i=i.next).drop.gid==t.gid&&(e.next=i.next)},EpubPlugins.creatClass({pluginName:"rainyday",createdCallback:function(){},attributeChangedCallback:function(){},attachedCallback:function(){var i=this,e=document.createElement("img"),s=this.getAttribute("data-img")||web_url+"common/js/interaction_edit/plugins/rainyday/rainyday.jpg",r=1*(this.getAttribute("data-preset")||1);i.plugin={},e.onload=function(){var s=new t(i.canvas,e,i.innerWidth,i.innerHeight,1,20);1==r?(s.gravity=s.GRAVITY_NON_LINEAR,s.trail=s.TRAIL_DROPS,s.rain([s.preset(3,3,.88),s.preset(5,5,.9),s.preset(6,2,1)],100)):2==r?(s.gravity=s.GRAVITY_NON_LINEAR,s.trail=s.TRAIL_DROPS,s.VARIABLE_GRAVITY_ANGLE=Math.PI/8,s.rain([s.preset(0,2,.5),s.preset(4,4,1)],50)):3==r&&(s.gravity=s.GRAVITY_NON_LINEAR,s.trail=s.TRAIL_SMUDGE,s.rain([s.preset(0,2,.5),s.preset(4,4,1)],50));var a={};for(var n in s)a[n]=s[n];for(var n in i.plugin)a[n]=i.plugin[n];i.plugin=a},e.crossOrigin="anonymous",e.src=s},create:function(){epub360.plugin.create({source:'<epub-rainyday  style="pointer-events: none;width:100%;height:100%;position:absolute;overflow:hidden;" ></epub-rainyday>',type:"EpubRainyday"})},focus:function(t,i){},close:function(t,i){},remove:function(t,i){},resize:function(){}})}.call(void 0)}.apply(i,s))||(t.exports=r)}}]);